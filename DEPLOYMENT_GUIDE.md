# ðŸš€ Production Deployment Guide

## Pre-Deployment Checklist

### âœ… Step 1: Verify Changes

All authentication files are ready:
- âœ… Auth serializers, views, and URLs
- âœ… Templates with Tailwind CSS
- âœ… JWT authentication configured
- âœ… Updated requirements.txt with simplejwt

### âœ… Step 2: Commit Changes

```bash
# Add all new files
git add .

# Commit changes
git commit -m "Add user authentication system with JWT and modern UI

- Implemented JWT authentication with djangorestframework-simplejwt
- Created 7 API endpoints for user management
- Built modern UI with Tailwind CSS and Alpine.js
- Added registration, login, and profile pages
- Configured JWT tokens (1hr access, 7-day refresh)
- Added comprehensive documentation and tests"
```

### âœ… Step 3: Push to Heroku

```bash
# If you haven't set up Heroku remote yet:
# heroku git:remote -a your-app-name

# Push to Heroku
git push heroku master

# Or if you're on a different branch:
git push heroku main:master
```

### âœ… Step 4: Run Migrations

```bash
heroku run python manage.py migrate
```

### âœ… Step 5: Collect Static Files

```bash
heroku run python manage.py collectstatic --noinput
```

### âœ… Step 6: Create Superuser (Optional)

```bash
heroku run python manage.py createsuperuser
```

### âœ… Step 7: Verify Environment Variables

Make sure these are set in Heroku:

```bash
# Check existing config
heroku config

# Required variables (should already be set):
# - SECRET_KEY
# - DATABASE_URL (auto-set by Heroku Postgres)
# - REDIS_URL (auto-set by Heroku Redis)
# - AWS/Cloudcube credentials
# - API keys (OpenAI, Anthropic, etc.)

# Add if missing:
heroku config:set DEBUG=False
heroku config:set ALLOWED_HOSTS=.herokuapp.com,.koolclips.ai
```

## Quick Deployment Script

Save this as `deploy.sh` and run it:

```bash
#!/bin/bash

echo "ðŸš€ Starting deployment to Heroku..."

# 1. Commit changes
echo "ðŸ“¦ Committing changes..."
git add .
git commit -m "Deploy authentication system"

# 2. Push to Heroku
echo "â˜ï¸  Pushing to Heroku..."
git push heroku master

# 3. Run migrations
echo "ðŸ”„ Running migrations..."
heroku run python manage.py migrate

# 4. Collect static files
echo "ðŸ“ Collecting static files..."
heroku run python manage.py collectstatic --noinput

# 5. Restart dynos
echo "â™»ï¸  Restarting dynos..."
heroku restart

echo "âœ… Deployment complete!"
echo "ðŸŒ Your app: https://your-app-name.herokuapp.com"
```

## Testing Production Deployment

### 1. Test Web Interface

```bash
# Open your app
heroku open

# Or visit directly:
# https://your-app-name.herokuapp.com/
```

**Test Flow:**
1. Visit home page - should see landing page
2. Click "Sign Up" - should load registration page
3. Create an account - should redirect to profile
4. Test profile editing
5. Test password change
6. Log out and log back in

### 2. Test API Endpoints

```bash
# Set your app URL
export API_URL="https://your-app-name.herokuapp.com"

# Test registration
curl -X POST $API_URL/api/auth/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "prodtest",
    "email": "test@example.com",
    "password": "SecurePass123!",
    "password_confirm": "SecurePass123!"
  }'

# Test login
curl -X POST $API_URL/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "prodtest",
    "password": "SecurePass123!"
  }'

# Save the access token from response, then:
export TOKEN="your-access-token"

# Test profile
curl -X GET $API_URL/api/auth/profile/ \
  -H "Authorization: Bearer $TOKEN"
```

### 3. Monitor Logs

```bash
# Watch real-time logs
heroku logs --tail

# Check for errors
heroku logs --tail | grep ERROR

# Check recent logs
heroku logs --tail --num 100
```

## Production Configuration Verification

### Check Settings

```bash
# Verify DEBUG is False
heroku config:get DEBUG

# Check allowed hosts
heroku config:get ALLOWED_HOSTS

# Verify database
heroku pg:info

# Verify Redis
heroku redis:info
```

### Performance Optimization

```bash
# Scale web dynos
heroku ps:scale web=2

# Scale worker dynos (for Celery)
heroku ps:scale worker=1

# Check dyno status
heroku ps
```

## Security Checklist for Production

- [ ] `DEBUG=False` in production
- [ ] Strong `SECRET_KEY` (auto-generated by Heroku)
- [ ] HTTPS enabled (automatic on Heroku)
- [ ] Allowed hosts configured
- [ ] CSRF protection enabled
- [ ] JWT tokens with proper expiration
- [ ] Password validators active
- [ ] SQL injection protection (Django ORM)
- [ ] XSS protection enabled

## Post-Deployment Verification

### 1. Check Application Health

```bash
# Check if app is running
heroku ps

# Run health check
curl https://your-app-name.herokuapp.com/
```

### 2. Verify Authentication System

Visit these URLs and verify they load:
- âœ… `https://your-app-name.herokuapp.com/` - Home page
- âœ… `https://your-app-name.herokuapp.com/register/` - Registration
- âœ… `https://your-app-name.herokuapp.com/login/` - Login
- âœ… `https://your-app-name.herokuapp.com/profile/` - Profile (after login)

### 3. Test API Endpoints

All endpoints should return proper responses:
- âœ… POST `/api/auth/register/` - 201 Created
- âœ… POST `/api/auth/login/` - 200 OK
- âœ… GET `/api/auth/profile/` - 200 OK (with token)
- âœ… PATCH `/api/auth/profile/` - 200 OK (with token)
- âœ… POST `/api/auth/change-password/` - 200 OK (with token)
- âœ… POST `/api/auth/refresh/` - 200 OK

### 4. Check Static Files

Verify CSS and JS load properly:
- Open browser dev tools
- Check Network tab
- Verify Tailwind CSS CDN loads
- Verify Alpine.js CDN loads
- Check for any 404 errors

## Troubleshooting

### Issue: Templates Not Loading

```bash
# Verify templates directory exists
heroku run ls -la templates/

# Check settings
heroku run python manage.py shell
>>> from django.conf import settings
>>> print(settings.TEMPLATES)
```

### Issue: Static Files Not Loading

```bash
# Collect static files again
heroku run python manage.py collectstatic --noinput

# Check WhiteNoise configuration
heroku config | grep STATIC
```

### Issue: Database Errors

```bash
# Check database connection
heroku pg:info

# Run migrations
heroku run python manage.py migrate

# Check for pending migrations
heroku run python manage.py showmigrations
```

### Issue: API Returns 500 Error

```bash
# Check logs for detailed error
heroku logs --tail

# Run Django shell to debug
heroku run python manage.py shell
```

### Issue: JWT Tokens Not Working

Check JWT configuration in settings:
- Verify `rest_framework_simplejwt` is installed
- Check `SIMPLE_JWT` settings
- Verify `SECRET_KEY` is set

## Rollback Plan

If deployment fails:

```bash
# View recent releases
heroku releases

# Rollback to previous version
heroku rollback v123  # replace with version number

# Or rollback one version
heroku rollback
```

## Performance Monitoring

```bash
# Monitor application metrics
heroku logs --tail --ps web

# Check dyno usage
heroku ps

# Monitor response times
heroku logs --tail | grep "request_id"
```

## Custom Domain Setup (Optional)

If you have a custom domain:

```bash
# Add domain
heroku domains:add www.koolclips.ai

# Get DNS target
heroku domains

# Update ALLOWED_HOSTS
heroku config:set ALLOWED_HOSTS=.herokuapp.com,.koolclips.ai,www.koolclips.ai
```

## Continuous Deployment (Optional)

Set up automatic deployment from GitHub:

1. Go to Heroku Dashboard
2. Select your app
3. Click "Deploy" tab
4. Connect to GitHub
5. Enable "Automatic deploys"
6. Choose branch (main/master)

## Post-Deployment Tasks

1. **Test all features thoroughly**
   - Registration flow
   - Login flow
   - Profile management
   - Password change
   - Account deletion

2. **Monitor for errors**
   ```bash
   heroku logs --tail
   ```

3. **Set up monitoring**
   - Enable Heroku metrics
   - Set up error tracking (Sentry, etc.)
   - Configure uptime monitoring

4. **Update documentation**
   - Update README with production URL
   - Document any production-specific setup

## Success Checklist

- [ ] Code committed to Git
- [ ] Pushed to Heroku
- [ ] Migrations run successfully
- [ ] Static files collected
- [ ] Environment variables verified
- [ ] Home page loads
- [ ] Registration works
- [ ] Login works
- [ ] Profile page loads
- [ ] API endpoints respond
- [ ] No errors in logs
- [ ] SSL/HTTPS working
- [ ] Custom domain configured (if applicable)

## Support Resources

- **Heroku Docs**: https://devcenter.heroku.com/
- **Django Deployment**: https://docs.djangoproject.com/en/4.2/howto/deployment/
- **JWT Docs**: https://django-rest-framework-simplejwt.readthedocs.io/

---

## Quick Command Reference

```bash
# Deploy
git push heroku master

# Migrate
heroku run python manage.py migrate

# Logs
heroku logs --tail

# Shell
heroku run python manage.py shell

# Restart
heroku restart

# Scale
heroku ps:scale web=2 worker=1

# Config
heroku config
heroku config:set KEY=VALUE

# Database
heroku pg:info
heroku pg:psql

# Rollback
heroku rollback
```

---

**Ready to deploy? Run these commands in order! ðŸš€**
